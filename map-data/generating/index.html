



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="General project documentation for National Scenic Trails Guide">
      
      
        <link rel="canonical" href="https://nst-guide.github.io/docs/map-data/generating/">
      
      
        <meta name="author" content="Kyle Barron">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Generating Map Data - National Scenic Trails Guide documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,700%7CFira+Code&display=fallback">
        <style>body,input{font-family:"Nunito Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Code","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#generate-map-data" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://nst-guide.github.io/docs/" title="National Scenic Trails Guide documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">home</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              National Scenic Trails Guide documentation
            </span>
            <span class="md-header-nav__topic">
              
                Generating Map Data
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/nst-guide/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nst-guide/docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://nst-guide.github.io/docs/" title="National Scenic Trails Guide documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">home</i>
      
    </a>
    National Scenic Trails Guide documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/nst-guide/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nst-guide/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Map Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Map Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Generating Map Data
      </label>
    
    <a href="./" title="Generating Map Data" class="md-nav__link md-nav__link--active">
      Generating Map Data
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#raster-vs-vector-tiles" class="md-nav__link">
    Raster vs Vector tiles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openmaptiles" class="md-nav__link">
    OpenMapTiles
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamic-tile-generation" class="md-nav__link">
    Dynamic tile generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-tile-generation" class="md-nav__link">
    Static tile generation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contours" class="md-nav__link">
    Contours
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hillshading" class="md-nav__link">
    Hillshading
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hosting/" title="Hosting Map Data" class="md-nav__link">
      Hosting Map Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#raster-vs-vector-tiles" class="md-nav__link">
    Raster vs Vector tiles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openmaptiles" class="md-nav__link">
    OpenMapTiles
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamic-tile-generation" class="md-nav__link">
    Dynamic tile generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-tile-generation" class="md-nav__link">
    Static tile generation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contours" class="md-nav__link">
    Contours
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hillshading" class="md-nav__link">
    Hillshading
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nst-guide/docs/blob/master/docs/src/map-data/generating.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="generate-map-data">Generate Map Data<a class="headerlink" href="#generate-map-data" title="Permanent link">&para;</a></h1>
<p>A map of the globe contains so much information that it would be impossible to
transmit all that information at high scale to a user at once. That's why <a href="https://www.maptiler.com/google-maps-coordinates-tile-bounds-projection/">map
tiling schemes</a> <a href="https://en.wikipedia.org/wiki/Tiled_web_map">exist</a>. With the
standard <a href="https://en.wikipedia.org/wiki/Web_Mercator_projection">pseudo-mercator tiling scheme</a>, map zoom level 0 covers the globe; zoom level 1 is split into 4 tiles; zoom level 2 is split
into 16 tiles, and so on. Zoom level <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> has <span><span class="MathJax_Preview">4^n</span><script type="math/tex">4^n</script></span> tiles that cover the globe.</p>
<h2 id="raster-vs-vector-tiles">Raster vs Vector tiles<a class="headerlink" href="#raster-vs-vector-tiles" title="Permanent link">&para;</a></h2>
<p>Historically, map tiles were PNG images. This meant that for a web browser or
mobile phone to display the map, all they had to do was display a collection of
images. That approach is pretty simple for the client, which allows it to work
on low-powered devices like those of the late 2000s.</p>
<p>Modern map technology is going away from raster tiles and toward vector tiles.
Instead of encoding RGB values of pixels, it encodes the <em>actual geometries</em> of
the roads, streams, and points of interest to be displayed. This requires more
effort on the client, but opens up a whole host of opportunities:</p>
<ul>
<li><strong>Smooth zooming</strong>. Since the tiles are rendered on the client, you can have fractional zooms without any pixelation.</li>
<li><strong>Dynamic styling</strong>. Change how the map looks without needing to download new data.</li>
<li><strong>Smaller file sizes</strong>. In general, vector tiles have smaller file sizes than their raster equivalents.</li>
<li><strong>Extract data from the tile</strong>. Since the geometries are encoded in the data received by the client, the client could potentially do cool stuff like basic routing without needing any new data.</li>
</ul>
<p>Note that this isn't to say raster data is going away entirely! Some data is
still well-suited to rasters, like aerial imagery or hillshading.</p>
<h2 id="openmaptiles">OpenMapTiles<a class="headerlink" href="#openmaptiles" title="Permanent link">&para;</a></h2>
<p>The OpenMapTiles project defines a <em>schema</em> for how to encode data from
OpenStreetMap into files conforming to the <a href="https://github.com/mapbox/vector-tile-spec">Mapbox Vector Tile
specification</a>, and offers tools for converting OpenStreetMap data
into tiles of that schema.</p>
<p>The schema defines a collection of tags for the geometries encoded in the vector
tile, so that <em>styles</em> can be written for tiles with consistent layers. Note
that in order to use a Mapbox GL style, it must be written specifically for the
OpenMapTiles schema. A style written for the OpenMapTiles schema won't work with
vector tile data coming from Mapbox, and a style written for Mapbox's vector
tile schema won't work for OpenMapTiles. That means you can't just take a
default Mapbox style, and use it for OpenMapTiles.</p>
<h3 id="dynamic-tile-generation">Dynamic tile generation<a class="headerlink" href="#dynamic-tile-generation" title="Permanent link">&para;</a></h3>
<p>If you're trying to serve map tiles for a huge area, such as the entire globe,
or with constant updates, the standard procedure would be to generate tiles
dynamically.</p>
<p>The process for doing dynamic tile generation is roughly:</p>
<ul>
<li>Construct an OpenMapTiles Postgres database with all the data of your desired region</li>
<li>Create vector tiles on the fly, with a project such as <a href="https://github.com/urbica/martin"><code>martin</code></a>.</li>
</ul>
<p>This approach, however, has higher costs because you need Postgres running on
the backend. Since my project only serves the US and doesn't need constant
updates, I use static tile generation instead.</p>
<h3 id="static-tile-generation">Static tile generation<a class="headerlink" href="#static-tile-generation" title="Permanent link">&para;</a></h3>
<p>The general process for making tiles is:</p>
<ul>
<li>Install Docker</li>
<li>Clone the OpenMapTiles repository</li>
<li>Set the desired min/max zoom levels in <code>.env</code></li>
<li>Run for a region(s) of interest</li>
<li>Combine the output <code>.mbtiles</code> files into a single <code>.mbtiles</code> file</li>
<li><a href="../hosting/">Serve it</a></li>
</ul>
<p>I use a <a href="https://github.com/nst-guide/openmaptiles">modified fork</a> of
OpenMapTiles, which</p>
<ul>
<li>Encodes waterways and trails into the vector tiles at a lower zoom than the original OpenMapTiles project, so that they can be displayed when more zoomed out.</li>
<li>Adds <code>natural=spring</code> and <code>amenity=drinking_water</code> to the POI layer.</li>
</ul>
<p>In code, the process is</p>
<p><div class="codehilite"><pre><span></span>git clone https://github.com/nst-guide/openmaptiles
<span class="nb">cd</span> openmaptiles
sudo docker-compose pull
./quickstart.sh washington
cp data/tiles.mbtiles ./washington.mbtiles
./quickstart.sh oregon
cp data/tiles.mbtiles ./oregon.mbtiles
tile-join joined.mbtiles washington.mbtiles oregon.mbtiles
</pre></div>
The argument to <code>./quickstart.sh</code> is the region name. You can find valid region
names in the <a href="https://github.com/nst-guide/openmaptiles/blob/master/QUICKSTART.md#check-other-extracts">OpenMapTiles documentation</a>.</p>
<p>The regions are downloaded from <a href="http://download.geofabrik.de/">Geofabrik</a>. So if you wanted you
could run it on <code>north-america</code>, but I find it preferable to run smaller regions
at a time. By making a separate mbtiles for each state, you can update each
state individually. For example, if I generate individual <code>.mbtiles</code> files for
every state, and then want to regenerate the map tiles for the Pacific Crest
Trail, I only need to generate new data for California, Oregon, and Washington,
and then combine the existing data from all other states with
<a href="https://github.com/mapbox/tippecanoe#tile-join"><code>tile-join</code></a>. So I'm never forced to regenerate data for more than
one state at a time.</p>
<p>Now that you've created a single <code>.mbtiles</code> file, you're <a href="../hosting/">to host
it</a>.</p>
<h2 id="contours">Contours<a class="headerlink" href="#contours" title="Permanent link">&para;</a></h2>
<p>I originally generated contours vector tiles straight from USGS vector data
(<a href="https://github.com/nst-guide/contours">https://github.com/nst-guide/contours</a>).
These downloads have contour lines pregenerated in vector format, and so are quite
easy to work with; just download, run <code>ogr2ogr</code> to convert to GeoJSON, and then
run <a href="https://github.com/mapbox/tippecanoe"><code>tippecanoe</code></a> to convert to vector tiles.</p>
<p>There are a couple drawbacks of using the USGS vector contour data:</p>
<ol>
<li>Inconsistent vertical spacing. In some areas, I found that the data included
    10' contours, while others had a precision of only <em>80'</em>. Since I desired a
    40' contour, this meant that there were occasionally visual discontinuities
    in the map between tiles with source data of at least 40' precision and
    source data of less than 40' precision.</li>
<li>
<p>Metric contours. Although I'm currently making maps of the United States,
    where imperial measurements are the standard, it's desirable to provide
    metric measurements as well. With Mapbox GL, it's quite easy to write a
    style expression that converts feet into meters, but the <em>spacing</em> of the
    contour lines will still be in feet. If neighboring imperial contour lines
    are 2000 feet and 2040 feet, displaying those same lines on a metric map
    would represent unintuitive values of 609.6 meters and 621.8 meters.</p>
<p>In order to display metric contour lines, it is necessary to generate a
separate set of contours with lines that represent 100 meters, 110 meters,
etc. This must be generated from the original DEMs.</p>
</li>
</ol>
<p>Because of these issues, I try to generate contour data from the original DEMs,
using code in <a href="https://github.com/nst-guide/terrain"><code>nst-guide/terrain</code></a>.</p>
<h2 id="hillshading">Hillshading<a class="headerlink" href="#hillshading" title="Permanent link">&para;</a></h2>
<p>Historically, the way to make a hillshade is to generate raster images where
each cell stores the level of grayscale to display.</p>
<p>With Mapbox GL, you have a new option: <a href="https://docs.mapbox.com/help/troubleshooting/access-elevation-data/#mapbox-terrain-rgb">Terrain RGB
tiles</a>.
Instead of encoding the grayscale in the raster, it encodes the <em>raw elevation
value</em> in 0.1m increments. This enables a whole host of cool things to do
client-side, like retrieving elevation for a point, or generating the viewshed
from a point.</p>
<p>I currently exclusively use Terrain RGB tiles in my projects because it allows for
the possibility of doing cool things client-side with elevation data.</p>
<p>I generate Terrain tiles in <a href="https://github.com/nst-guide/terrain"><code>nst-guide/terrain</code></a>.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="../hosting/" title="Hosting Map Data" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Hosting Map Data
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/nst-guide" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../helpers/helpers.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>